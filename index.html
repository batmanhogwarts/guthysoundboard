<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>North Hollywood High School Fire Alarm Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Fonts and Font Awesome -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-j4Q4GpQ5CX3kZsI2e00E5R3wAaN/lX3RC3CDgW+5HJx2XV9Z0F8Zecm6IZD8qFfq" crossorigin="anonymous" />
    <!-- Stylesheet -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-text">
                <h1>North Hollywood High School Fire Alarm Tracker</h1>
                <p>Keeping track of fire alarms at NoHo</p>
            </div>
            <div class="header-logo">
                <img src="logo-placeholder.png" alt="School Logo">
            </div>
        </div>
    </div>

    <!-- Calendar Navigation -->
    <div class="calendar-nav">
        <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
        <h2 id="calendarMonthYear">Month Year</h2>
        <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- Calendar -->
    <div class="calendar-container">
        <div class="calendar" id="calendar">
            <!-- Calendar will be generated by JavaScript -->
        </div>
        <div class="calendar-buttons">
            <button id="currentMonthButton">Current Month</button>
            <button id="lastAlarmButton">Last Alarm</button>
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats">
        <!-- Days Without a Fire Alarm -->
        <div class="stat">
            <div class="number" id="daysWithoutAlarm">--</div>
            <div class="unit">days</div>
            <p>Days Without a Fire Alarm</p>
        </div>
        <!-- Last Alarm Date -->
        <div class="stat">
            <div class="number" id="lastAlarmDate">--</div>
            <p>Last Alarm Date</p>
        </div>
        <!-- Elapsed Time Since Last Alarm -->
        <div class="stat">
            <p>Elapsed Time Since Last Alarm</p>
            <div class="stat-numbers">
                <div class="number-unit">
                    <div class="number" id="elapsedDays">--</div>
                    <div class="unit">days</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="elapsedHours">--</div>
                    <div class="unit">hours</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="elapsedMinutes">--</div>
                    <div class="unit">minutes</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="elapsedSeconds">--</div>
                    <div class="unit">seconds</div>
                </div>
            </div>
        </div>
        <!-- Longest Time Between Alarms -->
        <div class="stat">
            <p>Longest Time Between Alarms</p>
            <div class="stat-numbers">
                <div class="number-unit">
                    <div class="number" id="longestDays">--</div>
                    <div class="unit">days</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="longestHours">--</div>
                    <div class="unit">hours</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="longestMinutes">--</div>
                    <div class="unit">minutes</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="longestSeconds">--</div>
                    <div class="unit">seconds</div>
                </div>
            </div>
        </div>
        <!-- Shortest Time Between Alarms -->
        <div class="stat">
            <p>Shortest Time Between Alarms</p>
            <div class="stat-numbers">
                <div class="number-unit">
                    <div class="number" id="shortestDays">--</div>
                    <div class="unit">days</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="shortestHours">--</div>
                    <div class="unit">hours</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="shortestMinutes">--</div>
                    <div class="unit">minutes</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="shortestSeconds">--</div>
                    <div class="unit">seconds</div>
                </div>
            </div>
        </div>
        <!-- Average Time Between Alarms -->
        <div class="stat">
            <p>Average Time Between Alarms</p>
            <div class="stat-numbers">
                <div class="number-unit">
                    <div class="number" id="averageDays">--</div>
                    <div class="unit">days</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="averageHours">--</div>
                    <div class="unit">hours</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="averageMinutes">--</div>
                    <div class="unit">minutes</div>
                </div>
                <div class="number-unit">
                    <div class="number" id="averageSeconds">--</div>
                    <div class="unit">seconds</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>&copy; 2024 North Hollywood High School Fire Alarm Tracker</p>
    </div>

    <!-- JavaScript -->
    <script>
        let alarmTimes = [];
        let alarmMap = {};
        let displayMonth;
        let displayYear;
        let lastAlarm;

        // Fetch the data from data.json
        fetch('data.json')
        .then(response => response.json())
        .then(data => {
            // Process the data
            alarmTimes = data.times.map(datetimeStr => new Date(datetimeStr));
            alarmTimes.sort((a, b) => a - b); // Sort dates ascending

            // Update Statistics
            updateStatistics(alarmTimes);

            // Set the default display month and year to the last alarm month
            lastAlarm = alarmTimes[alarmTimes.length - 1];
            displayMonth = lastAlarm.getMonth();
            displayYear = lastAlarm.getFullYear();

            // Generate Alarm Map
            generateAlarmMap();

            // Generate Calendar
            generateCalendar(displayMonth, displayYear);
        })
        .catch(error => console.error('Error fetching data:', error));

        function updateStatistics(alarmTimes) {
            const now = new Date();
            const lastAlarm = alarmTimes[alarmTimes.length - 1];

            // Days Without a Fire Alarm
            const daysWithout = Math.floor((now - lastAlarm) / (1000 * 60 * 60 * 24));
            document.getElementById('daysWithoutAlarm').innerText = daysWithout;

            // Last Alarm Date
            document.getElementById('lastAlarmDate').innerText = lastAlarm.toLocaleString();

            // Elapsed Time Since Last Alarm
            updateTimeSinceLastAlarm(lastAlarm);

            // Calculate intervals between alarms
            const intervals = [];
            for (let i = 1; i < alarmTimes.length; i++) {
                const diff = alarmTimes[i] - alarmTimes[i - 1];
                intervals.push(diff);
            }

            if (intervals.length > 0) {
                // Longest Interval
                const longestInterval = Math.max(...intervals);
                setDurationElements(longestInterval, 'longest');

                // Shortest Interval
                const shortestInterval = Math.min(...intervals);
                setDurationElements(shortestInterval, 'shortest');

                // Average Interval
                const averageInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                setDurationElements(averageInterval, 'average');
            } else {
                // Set '--' for durations
                ['longest', 'shortest', 'average'].forEach(prefix => {
                    document.getElementById(prefix + 'Days').innerText = '--';
                    document.getElementById(prefix + 'Hours').innerText = '--';
                    document.getElementById(prefix + 'Minutes').innerText = '--';
                    document.getElementById(prefix + 'Seconds').innerText = '--';
                });
            }
        }

        function updateTimeSinceLastAlarm(lastAlarm) {
            function updateCounter() {
                const now = new Date();
                const duration = now - lastAlarm;

                const seconds = Math.floor((duration / 1000) % 60);
                const minutes = Math.floor((duration / (1000 * 60)) % 60);
                const hours = Math.floor((duration / (1000 * 60 * 60)) % 24);
                const days = Math.floor(duration / (1000 * 60 * 60 * 24));

                document.getElementById('elapsedDays').innerText = days;
                document.getElementById('elapsedHours').innerText = hours;
                document.getElementById('elapsedMinutes').innerText = minutes;
                document.getElementById('elapsedSeconds').innerText = seconds;
            }

            updateCounter();
            setInterval(updateCounter, 1000);
        }

        function setDurationElements(duration, prefix) {
            const seconds = Math.floor((duration / 1000) % 60);
            const minutes = Math.floor((duration / (1000 * 60)) % 60);
            const hours = Math.floor((duration / (1000 * 60 * 60)) % 24);
            const days = Math.floor(duration / (1000 * 60 * 60 * 24));

            document.getElementById(prefix + 'Days').innerText = days;
            document.getElementById(prefix + 'Hours').innerText = hours;
            document.getElementById(prefix + 'Minutes').innerText = minutes;
            document.getElementById(prefix + 'Seconds').innerText = seconds;
        }

        function generateAlarmMap() {
            // Group alarm times by date
            alarmMap = {};
            alarmTimes.forEach(alarm => {
                const dateKey = alarm.toISOString().split('T')[0];
                if (!alarmMap[dateKey]) {
                    alarmMap[dateKey] = [];
                }
                alarmMap[dateKey].push(alarm);
            });
        }

        function generateCalendar(month, year) {
            const calendarElement = document.getElementById('calendar');
            calendarElement.innerHTML = ''; // Clear previous calendar

            // Update the calendar month and year display
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            document.getElementById('calendarMonthYear').innerText = `${monthNames[month]} ${year}`;

            // Create headers for the days of the week
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            for (let day of daysOfWeek) {
                const dayElement = document.createElement('div');
                dayElement.classList.add('day', 'header');
                dayElement.innerText = day;
                calendarElement.appendChild(dayElement);
            }

            // Get the first day of the month
            const firstDay = new Date(year, month, 1).getDay();

            // Get the number of days in the month
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Fill in the blanks before the first day
            for (let i = 0; i < firstDay; i++) {
                const blankElement = document.createElement('div');
                blankElement.classList.add('day');
                calendarElement.appendChild(blankElement);
            }

            // Fill in the days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateKey = date.toISOString().split('T')[0];

                const dayElement = document.createElement('div');
                dayElement.classList.add('day');
                dayElement.innerText = day;

                // Check if this date is in the alarmMap
                if (alarmMap[dateKey]) {
                    const alarmCount = alarmMap[dateKey].length;

                    // Adjust the red color intensity based on the number of alarms
                    const redIntensity = Math.min(255, 100 + (alarmCount * 30));
                    dayElement.style.backgroundColor = `rgb(${redIntensity}, 0, 0)`;
                    dayElement.style.color = '#fff';
                    dayElement.style.fontWeight = '600';

                    // Add hover tooltip with times
                    const tooltip = document.createElement('div');
                    tooltip.classList.add('tooltip');
                    tooltip.innerHTML = alarmMap[dateKey]
                        .map(alarm => alarm.toLocaleTimeString())
                        .join('<br>');

                    dayElement.appendChild(tooltip);
                    dayElement.classList.add('has-tooltip');
                }

                calendarElement.appendChild(dayElement);
            }
        }

        // Event Listeners for Navigation
        document.getElementById('prevMonth').addEventListener('click', () => {
            if (displayMonth === 0) {
                displayMonth = 11;
                displayYear--;
            } else {
                displayMonth--;
            }
            generateCalendar(displayMonth, displayYear);
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            if (displayMonth === 11) {
                displayMonth = 0;
                displayYear++;
            } else {
                displayMonth++;
            }
            generateCalendar(displayMonth, displayYear);
        });

        document.getElementById('currentMonthButton').addEventListener('click', () => {
            const now = new Date();
            displayMonth = now.getMonth();
            displayYear = now.getFullYear();
            generateCalendar(displayMonth, displayYear);
        });

        document.getElementById('lastAlarmButton').addEventListener('click', () => {
            displayMonth = lastAlarm.getMonth();
            displayYear = lastAlarm.getFullYear();
            generateCalendar(displayMonth, displayYear);
        });
    </script>
</body>
</html>
